version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile

    container_name: worldcharacters-dev

    volumes:
      - ../:/WorldCharacters:cached

    ports:
      - "5173:5173"   # livekit-stream Vite dev server
      - "5174:5174"   # 3d-viewer Vite dev server
      - "6080:6080"   # noVNC (browser visible from Windows)
      - "9009:9009"   # Browser MCP WebSocket

    shm_size: '256m'  # Chromium needs shared memory for WebGL rendering

    # Security hardening
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
      - SYS_ADMIN     # Needed for Chromium sandboxing

    security_opt:
      - no-new-privileges:true

    command: sleep infinity
